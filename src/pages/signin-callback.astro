---
import Layout from "@/layouts/Layout.astro";
---

<Layout />
<script>
  import { userManager } from "@/lib/auth";

  const setSecureAccessTokenCookie = (
    token: string,
    expiresIn: number = 3601
  ) => {
    const isDev = import.meta.env.DEV === true;

    document.cookie =
      `access_token=${token}; ` +
      `Path=/; ` +
      `Secure; ` +
      `SameSite=Strict; ` +
      `${isDev ? "" : "HttpOnly; "}` + // won't be set in the browser if enabled, omit in local host
      `Max-Age=${expiresIn}`;
  };

  const user = await userManager.signinCallback();

  if (user && user.access_token) {
    setSecureAccessTokenCookie(user.access_token, user.expires_in);
  }

  window.location.href = "/todos";
</script>

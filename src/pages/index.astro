---
import { Button } from "@/components/ui/button";
import Content from "../components/Content.astro";
import Hero from "../components/Hero.astro";
import Layout from "../layouts/Layout.astro";
import NavBar from "@/components/NavBar.astro";

import "../styles/global.css";
---

<Layout>
  <NavBar />
  <Content>
    <div slot="default">
      <Hero />
      <Button id="login-button">My Todos</Button>
    </div>
  </Content>
</Layout>
<script>
  import { userManager } from "@/lib/auth";

  document.addEventListener("DOMContentLoaded", async () => {
    const user = await userManager.getUser();

    const loggedIn = user && !Boolean(user.expired);
    const loginButton = document.getElementById("login-button");

    loginButton?.addEventListener("click", (e) => {
      e.preventDefault();
      if (loggedIn) {
        console.log("you are already logged in");

        window.location.href = "/todos";
      } else {
        console.log("you need to log in");
        window.location.href = "/login";
      }
    });
  });
</script>

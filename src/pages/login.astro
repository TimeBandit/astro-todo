---
import Content from "@/components/Content.astro";
import Layout from "@/layouts/Layout.astro";

import avatar from "../assets/avatar.svg";
import NavBar from "@/components/NavBar.astro";
import { AvatarComponent } from "@/components/Avatar";
---

<Layout>
  <NavBar>
    <AvatarComponent src={avatar.src} alt="user" fallbackText="" />
  </NavBar>
  <Content>
    <div id="message">
      Please login. Redirecting to the login page...in 5 seconds
    </div>
  </Content>
</Layout>
<script>
  import { userManager } from "@/lib/auth";
  import { sleep } from "@/lib/helper";

  const messageElement = document.getElementById("message");
  const access_token = 
  const handleLogin = async () => {
    try {
      const response = await fetch("/api/auth/login", {
        headers: { Authorization: `Bearer ${userManager.getUser()}` },
      });
      if (response.ok) {
        // Handle successful logout (e.g., redirect or update UI state)
        console.info("Server indicates browser token removal");
      }
    } catch (error) {
      console.error("Logout failed:", error);
    }
  };

  for (let index = 3; index > 0; index--) {
    await sleep(1);
    if (messageElement && messageElement.textContent)
      messageElement.textContent = `Please login. Redirecting to the login page...in ${index} seconds`;
  }
  await userManager.signinRedirect();
</script>

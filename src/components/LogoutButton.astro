---
import { Button } from "@/components/ui/button";

// Get the session token or auth status from cookies/headers
const cookies = Astro.request.headers.get("Cookie");
const isAuthenticated = cookies?.includes("access_token");
console.log(Astro.request.headers);
console.log("<<HELLO>>: ", isAuthenticated);
// If not authenticated, return nothing
// if (!isAuthenticated) {
//   return;
// }

// export const prerender = false;
---

<Button id="logoutButton">Logout</Button>

<script>
  const removeAccessTokenCookie = () => {
    document.cookie =
      "access_token=; " +
      "Path=/; " +
      "Secure; " +
      "SameSite=Strict; " +
      "HttpOnly; " +
      "expires=Thu, 01 Jan 1970 00:00:01 GMT";
  };

  const button = document.getElementById("logoutButton");

  button?.addEventListener("click", async () => {
    const userManager = (await import("@/lib/auth")).userManager;
    const signOutRedirect = (await import("@/lib/auth")).signOutRedirect;

    await userManager.removeUser();
    removeAccessTokenCookie();
    await signOutRedirect();
  });
</script>
